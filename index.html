<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Airport Autocomplete</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        input{
            text-transform: capitalize;
        }
        .suggestions-box {
            background: white;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
            width: 200px; /* Adjust width as needed */
            max-height: 150px; /* Set max height */
            overflow-y: auto; /* Enable scrolling if necessary */
            text-transform: capitalize;
        }
        .airport-info{
            font-size: 14px;
            margin-top: 5px;
        }
        .suggestions-box div {
            padding: 10px;
            cursor: pointer;
        }
        .suggestions-box div:hover {
            background-color: #f0f0f0; /* Highlight on hover */
        }
    </style>
</head>
<body>
    <div style="position: relative;"> <!-- Added relative positioning -->
        <input type="text" id="departure-airport" placeholder="Departure Airport" />
        <div class="suggestions-box"></div>
    </div>
    <div style="position: relative;"> <!-- Added relative positioning -->
        <input type="text" id="arrival-airport" placeholder="Arrival Airport" />
        <div class="suggestions-box"></div>
    </div>
    <script>
        const apiUrl = "http://localhost:3000/api/airports";

        async function fetchAirportData(query) {
            if (!query) return [];

            try {
                const response = await fetch(`${apiUrl}?name=${query}`);
                if (!response.ok) throw new Error("Network response was not ok");
                return await response.json(); 
            } catch (error) {
                console.error("Error fetching airport data:", error);
                return [];
            }
        }

        function enableAutocomplete() {
            const departureField = document.getElementById("departure-airport");
            const arrivalField = document.getElementById("arrival-airport");

            if (departureField) {
                departureField.addEventListener("input", async function () {
                    const airportList = await fetchAirportData(this.value);
                    autocompleteSuggestions(this, airportList);
                });
            }
            if (arrivalField) {
                arrivalField.addEventListener("input", async function () {
                    const airportList = await fetchAirportData(this.value);
                    autocompleteSuggestions(this, airportList);
                });
            }
        }

        function autocompleteSuggestions(field, list) {
            const inputValue = field.value.toLowerCase();

            console.log(inputValue)
            let suggestionBox = field.nextElementSibling;

            if (suggestionBox) {
                suggestionBox.innerHTML = "";
            } else {
                suggestionBox = document.createElement("div");
                suggestionBox.classList.add("suggestions-box");
                field.parentNode.insertBefore(suggestionBox, field.nextSibling);
            }

            if (list.length === 0) {
                suggestionBox.innerHTML = "<div class='suggestions-box'>No results found</div>";
                return; 
            }

            list.forEach((airport) => {
                const suggestion = document.createElement("div");
                
                suggestion.innerHTML = `
                    <strong>${airport.name}</strong><br />
                    <span class="airport-info">${airport.city || 'N/A'}</span>
                `;
                
                suggestion.addEventListener("click", function () {
                    field.value = `${airport.name}, ${airport.city}`;
                    suggestionBox.innerHTML = "";
                });
                suggestionBox.appendChild(suggestion);
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            enableAutocomplete();
        });
    </script>
</body>
</html>
